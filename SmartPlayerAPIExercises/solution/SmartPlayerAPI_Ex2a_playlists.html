<!DOCTYPE html>
<html>
	<head>
		<title>Mulitiple Playlist Exercise 2a</title>
				<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" type="text/css" href="SmartPlayerAPI.css" />
	</head>
	<body>
		<h2>Smart Player API Multiple Playlists Example 1</h2>
		<p><em>The buttons below are for development purposes only, to switch between Flash and  HTML5 players. Do not use these in production, as the method is unsupported. You should let the Smart Player decide whether to load Flash or HTML5 instead.</em></p>
		<div id="modeSwitch">
			<button onclick="switchToHTML5()" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</button>
			<button onclick="switchToFlash()" style="margin-bottom: 20px;">Switch to Flash Player</button>
		</div>
		<table>
			<tbody>
				<tr>
					<td valign="top">
						<!-- Start of Brightcove Player - replace with your player code - remember that the ActionScript/JavaScript APIs MUST be enabled in the player settings, and you must add two additonal param tags to the publishing code as I have done below, and that the <object> id value must match the id in the onTemplateReady function player = brightcove.api.getExperience("myExperience"); line -->
								<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>

								<object id="myExperience" class="BrightcoveExperience">
								  <param name="bgcolor" value="#FFFFFF" />
								  <param name="width" value="480" />
								  <param name="height" value="270" />
								  <param name="playerID" value="1146049103001" />
								  <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WEd1K9zn5lA_OOffNUFbVae" />
								  <param name="isVid" value="true" />
								  <param name="isUI" value="true" />
								  <param name="dynamicStreaming" value="true" />
								  <param name="@videoPlayer" value="928121847001" />
								  <!-- params for Smart Player API -->
								  <param name="includeAPI" value="true" />
								  <param name="templateReadyHandler" value="onTemplateReady" />
								</object>

								<script type="text/javascript">brightcove.createExperiences();</script>

								<!-- End of Brightcove Player -->
					</td>
					<td>
						<div id="BCL_playlist"></div>
					</td>
				</tr>
				<tr>
					<td colspan="2">
						<div id="BCL_playlistSelector"></div>
					</td>
				</tr>
			</tbody>
		</table>
    <fieldset>
      <legend>Playlist Selector</legend>
			<div id="results"></div>
    </fieldset><br>
		<!-- include handlebars.js templating system -->
		<script type="text/javascript" src="http://files.brightcove.com/handlebars-1.0.0.beta.6.js"></script>
		<script type="text/javascript">
			(function() {
  			// array of playlist IDs - substitute your list of playlist IDs
  			var playlists = [1323984735001,1323984733001,1323984734001];
  			// master array to hold retrieved playlist data
  			var playlistsData = [];
  			// markup templates
  			var selectorTemplate = "<select id='playlistSelector' onChange=\"onPlaylistSelect(this.selectedIndex - 1)\"><option>Select a playlist</option>{{#playlistsData}}<option value=\"{{id}}\">{{displayName}}</option>{{/playlistsData}}</select>";
  			var playlistTemplate = "{{#videos}}<div class=\"playlist\"><a onclick=\"playVideo({{id}})\"><img class=\"thumbnail\" height=\"40\" width=\"75\" src=\"{{thumbnailURL}}\"/><div class=\"description\"><span style=\"font-size:12px;\">{{displayName}}</span><br/>{{shortDescription}}</div></a></div>{{/videos}}";
  			// event listener for the player being ready
  			onTemplateReady = function(event) {
  			  console.log("onTemplateReady");
  			  // get references to the player and modules
  			  player = brightcove.api.getExperience("myExperience");
  			  videoPlayer = player.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER);
  			  contentModule = player.getModule(brightcove.api.modules.APIModules.CONTENT);
  			  // start retrieving the playlists
  			  buildPlaylistsData(0);
  			}
  			// retrieves the playlists from the Video Cloud service - because the calls are asynchronous, this function needs to keep calling itself until it has looped over the entire playlist ids array
  			buildPlaylistsData = function(counter) {
  				contentModule.getPlaylistByID(playlists[counter] , function(jsonData) {
  					playlistsData.push(jsonData);
  					if (counter < playlists.length - 1) {
  						// not done yet, function increments the counter and recalls itself
  						counter++;
  						buildPlaylistsData(counter);
  					}
  					else {
  						// now we're done, buid the selector
  						buildPlaylistSelector(playlistsData);
  					}
  				})
  			}
  			// function that builds the playlist selector
  			buildPlaylistSelector = function(playlistsData) {
  			  // populate the selector template with data
  			  console.log(playlistsData);
          var obj = {};
          obj.playlistsData = playlistsData;
          var template = Handlebars.compile(selectorTemplate);
          var data = obj;
          var results = template(data);
  			  document.getElementById("results").innerHTML = results;
  			}
  			// listener for playlist selection - builds the playlist
  			onPlaylistSelect = function(index) {
  			  // populate the playlist template with data
  			  console.log(playlistsData[index]);
          var template = Handlebars.compile(playlistTemplate);
          var data = playlistsData[index];
          var results = template(data);
     			document.getElementById("BCL_playlist").innerHTML = results;
  			}
  			// play video function
  			playVideo = function(videoID) {
  				videoPlayer.loadVideoByID(videoID);
  			}
  			// for development purposes only: reopen page with HTML5 player
  			switchToHTML5 = function() {
  				var separator = "?";
  				if (document.location.href.indexOf("?", 0) > -1) {
  					separator = "&";
  				}
  				window.location = document.location.href + separator + "forceHTML=true";
  			};
  			// for development purposes only: switch back to Flash
  			switchToFlash = function() {
  				var startOfQuery = document.location.href.indexOf("forceHTML", 0) -1;
  				window.location = document.location.href.substring(0, startOfQuery);
  			};
			})();
		</script>
	</body>
</html>

	<!DOCTYPE html>
<html>
	<head>
		<title>Player API Exercise 4f: Postroll Bumper</title>
		<link rel="stylesheet" type="text/css" href="SmartPlayerAPI.css" />
	</head>
	<body>
		<h1>Smart Player API Mid-Roll "Bumper" Example</h1>
		<p>This exercise uses the media COMPLETE event to launch what looks like a postroll bumper. It's not a true bumper, just another video from the account. The id of "bumper" here is stored in the Long Description as a JSON string: {"bumperID":123456789}. If you want to store the id elsewhere, you just need to adjust the script to retrieve it.</p>
		<p>The buttons below are for development purposes only, to switch between Flash and  HTML5 players. Do not use these in production, as the method is unsupported. You should let the Smart Player decide whether to load Flash or HTML5 instead.</p>
		<div id="modeSwitch">
			<button onclick="switchToHTML5()" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</button>
			<button onclick="switchToFlash()" style="margin-bottom: 20px;">Switch to Flash Player</button>
		</div>
		<!-- Start of Brightcove Player -->
		<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>
		
		<object id="myExperience" class="BrightcoveExperience">
		  <param name="bgcolor" value="#FFFFFF" />
		  <param name="width" value="480" />
		  <param name="height" value="270" />
		  <param name="playerID" value="1146049103001" />
		  <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WEd1K9zn5lA_OOffNUFbVae" />
		  <param name="isVid" value="true" />
		  <param name="isUI" value="true" />
		  <param name="dynamicStreaming" value="true" />
		  <param name="@videoPlayer" value="1187529587001" />
		  <!-- params for Smart Player API -->
		  <param name="includeAPI" value="true" />
		  <param name="templateLoadHandler" value="onTemplateLoad" />
		  <param name="templateReadyHandler" value="onTemplateReady" />
		</object>
		
		<script type="text/javascript">brightcove.createExperiences();</script>
		
		<!-- End of Brightcove Player -->
		<script type="text/javascript">
			(function(window) {
			// initialize vars
  			var player, videoPlayer, originalID;
        var bumper = {};
  			// flag to tell if we're playing the main video or the bumper
  			var playingBumper = false;
  			onTemplateLoad = function(experienceID) {
          player = brightcove.api.getExperience(experienceID);    			
          videoPlayer = player.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER);
  			}
  			onTemplateReady = function(event) {
  			  log("onTemplateReady");
  			  // capture the original video id and bumper id
  			  videoPlayer.getCurrentVideo( function(videoDTO) {
  				  originalID = videoDTO.id;
  				  // the bumper id is stored in a JSON string in the long description field
            bumper = JSON.parse(videoDTO.longDescription);
    			  // set a listener for media COMPLETE
    			  videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE, onMediaComplete);
    		  });
        }
  			// media complete handler
  			onMediaComplete = function(event) {
  				log("cue point");
  				log(event);
  				// see if the main video or bumper is playing
  				if (playingBumper) {
    				// bumper is finishing; cue the original video
    				playingBumper = false;
    				videoPlayer.cueVideoByID(originalID);
  				} else {
    				// main video finishing, play the bumper
    				playingBumper = true;
    				videoPlayer.loadVideoByID(bumper.bumperID);
  				}
  			}
  			// play the "bumper"
  			playBumper = function(videoID) {
  				log("starting the bumper");
  				// add listener for bumper complete
  				videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE, onBumperComplete);
  				// play the "bumper"
  				videoPlayer.loadVideoByID(videoID);
  			}
  			// for development purposes only: reopen page with HTML5 player
  			window.switchToHTML5 = function() {
  				var separator = "?";
  				if (document.location.href.indexOf("?", 0) > -1) {
  					separator = "&";
  				}
  				window.location = document.location.href + separator + "forceHTML=true";
  			};
  			// for development purposes only: switch back to Flash
  			window.switchToFlash = function() {
  				var startOfQuery = document.location.href.indexOf("forceHTML", 0) -1;
  				window.location = document.location.href.substring(0, startOfQuery);
  			};
  			// wrapper for logging
  			log = function (message) {
  			  if (window["console"] && console["log"]) {
  			    var d = Date.now();
  			    d = d.toLocaleString();
  			    console.log(d + ":");
  			    console.log(message);
  			  }
  			};
      })(window);
		</script>

	</body>
</html>

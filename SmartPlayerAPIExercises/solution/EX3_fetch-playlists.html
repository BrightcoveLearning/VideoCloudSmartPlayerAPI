<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Smart Player API Sample: Fetch Playlists</title>
    
    <link href="http://files.brightcove.com/proxima-nova/font-faces.css" rel="stylesheet" type="text/css" />
    <link href="./css/api-samples.css" rel="stylesheet" type="text/css" />
    <link href="./css/fetch-playlists.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
      <div id="main">
        <!-- id of first section is always "top" -->
        <div id="top" class="section">
          <h1><a name="top"></a>Smart Player API Sample: Fetch Playlists</h1>
          <p>This example fetches playlists from the Video Cloud media library and then displays them in the page to create a multi-playlist player that works in Flash or HTML5 mode.</p>
          <div class="text-warning">
            <h3>Note</h3>
            <ul>
              <li>This sample uses the <a href="http://jquery.org">jQuery</a> JavaScript library [1.9.0] to simplify code &mdash; all functionality can be replicated in ordinary JavaScript</li>
              <li>This sample uses the <a href="http://handlebars.org">Handlebars</a> templating system to simplify merging data with HTML to be injected into the DOM &mdash; all functionality can be replicated in ordinary JavaScript</li>
            </ul>
          </div>
        </div>
        <!-- every div class section must have an id -->
        <div class="section" id="resources">
          <h2><a name="resources"></a>API resources used</h2>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
          <ul>
            <li>CONTENT
              <ul>
                <li>fetchPlaylistByID()</li>
              </ul>
          </li>
            <li>VIDEO_PLAYER
              <ul>
                <li>loadVideoByID()</li>
              </ul>
            </li>
          </ul>
          <h4>Events</h4>
          <ul>
            <li>templateLoad</li>
            <li>templateReady</li>
          </ul>
        </div>
        <div class="section" id="player">
          <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
          <h2><a name="player"></a>The Player</h2>
          <p>A standard Chromeless Video Player is used for this sample.</p>
          <p class="text-warning">Note that the buttons below are for development purposes only &mdash; do not use in production.</p>
          <div id="modeSwitch">
            <span class="button" onclick="BCL.switchToHTML5()" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
            <span class="button" onclick="BCL.switchToFlash()" style="margin-bottom: 20px;">Switch to Flash Player</span>
          </div>
          <div id="BCL_playlistSelector"></div>
          <div id="playlist_player" class="player-block">
            <!-- Start of Brightcove Player -->
            <script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>
            <object id="myExperience921449663001" class="BrightcoveExperience">
              <param name="bgcolor" value="#FFFFFF" />
              <param name="width" value="480" />
              <param name="height" value="270" />
              <param name="playerID" value="2079935931001" />
              <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WE0z3yX6Xw29sdCvkH5GCJv" />
              <param name="isVid" value="true" />
              <param name="isUI" value="true" />
              <param name="dynamicStreaming" value="true" />
              <param name="@videoPlayer" value="921449663001" />
              <!-- smart player api params -->
              <param name="includeAPI" value="true" />
              <param name="templateLoadHandler" value="BCL.onTemplateLoad" />
              <param name="templateReadyHandler" value="BCL.onTemplateReady" />
            </object>
            <script type="text/javascript">brightcove.createExperiences();</script>
            <!-- End of Brightcove Player -->
          </div>
          <div id="BCL_playlist"></div>
        </div>
        <div class="section" id="logic">
          <h2><a name="logic"></a>How it is done</h2>
          <p>In the <code>templateReady</code> event handler, we get references to the VIDEO_PLAYER and CONTENT modules. Then we call a function that uses the CONTENT module <code>getPlaylistByID()</code> method to fetch the playlists for three IDs that are stored in an array. Because the call is asynchronous, the handler must recall the function until all the playlists are retrieved and stored in an array of objects.</p>
          <p>The rest is mostly just JavaScript and CSS. We build a set of tabs for the playlists. When a tab is clicked, the playlist is injected into a <code>div</code> below the tabs. To inject the initial playlist, we use jQuery to trigger a click event on the first tab immediately.</p>
          <p>Clicking on a playlist item calls a function, passing the video ID. We then simply call the VIDEO_PLAYER <code>loadVideoByID()</code> method to play the video.</p>
        </div>
        
      </div>
    </div>
    <!-- bcl scripts ============================================================ -->
    <script src="http://docs.brightcove.com/en/scripts/jquery-1.9.0.min.js"></script>
    <script src="http://docs.brightcove.com/en/scripts/handlebars-1.0.rc.2.js"></script>
    <script type="text/javascript">
      /******** Any scripts specific to page samples should go here *********/
      /**** Brightcove Learning namespace ****/
      var BCL = {};
      // array of playlist IDs - substitute your list of playlist IDs in quotation marks
      BCL.playlists = [1323984735001,1323984733001,1323984734001];
      // master array to hold retrieved playlist data
      BCL.obj = {};
      BCL.obj.playlistsData = [];
      // helper functions to reference array index in handlebars loop
      BCL.helpers = function() {
        var arrayIndex = -1;
        Handlebars.registerHelper('returnArrayIndex', function() {
          arrayIndex++;
          return arrayIndex;
        });
        Handlebars.registerHelper('reset_index', function() {
          arrayIndex = -1;
        })
      }();
      // Handlebars templates for the playlist selector and playlist
      BCL.selectorTemplate = "{{#playlistsData}}<span class=\"playlist-btn\" data-index=\"{{returnArrayIndex}}\">{{displayName}}</span>{{/playlistsData}}";
      BCL.playlistTemplate = "{{#videos}}<div class=\"playlist-item\" data-id=\"{{id}}\"><img height=\"50\" width=\"90\" src=\"{{thumbnailURL}}\"/><h5>{{displayName}}</h5><p>{{shortDescription}}</p></div>{{/videos}}";
      /**** template loaded event handler ****/
      BCL.onTemplateLoad = function (experienceID) {
        // get a reference to the player and API Modules and Events
        BCL.player = brightcove.api.getExperience(experienceID);
        BCL.APIModules = brightcove.api.modules.APIModules;
      };
      /**** template ready event handler ****/
      BCL.onTemplateReady = function (evt) {
        // get references to modules
        BCL.videoPlayer = BCL.player.getModule(BCL.APIModules.VIDEO_PLAYER);
        BCL.contentModule = BCL.player.getModule(BCL.APIModules.CONTENT);
        // fetch the playlists
        BCL.buildPlaylistsData(0);
      };
      /**** retrieves the playlists from the Video Cloud service
      * because the calls are asynchronous, 
      * this function needs to keep calling itself 
      * until it has looped over the entire playlist ids array ****/
      BCL.buildPlaylistsData = function (counter) {
        BCL.contentModule.getPlaylistByID(BCL.playlists[counter] , function(jsonData) {
          BCL.obj.playlistsData.push(jsonData);
          if (counter < BCL.playlists.length - 1) {
            // not done yet, function increments the counter and recalls itself
            counter++;
            BCL.buildPlaylistsData(counter);
          }
          else {
            // now we're done, buid the selector
            BCL.buildPlaylistSelector();
          }
        })
      }
      /**** function that builds the playlist selector ****/
      BCL.buildPlaylistSelector = function() {
        // populate the template with data
        var template = Handlebars.compile(BCL.selectorTemplate);
        var data = BCL.obj;
        var results = template(data);
        $("#BCL_playlistSelector").html(results);
        /**** 
        * listener for playlist selection - builds the playlist
        * using jquery here as it simplifies highlighting the selected tab
        ****/
        $("#BCL_playlistSelector span").on("click", function(evt) {
          var $this = $(this);
          // highlight the current tab
          $this.siblings().removeClass("playlist-btn-selected").addClass("playlist-btn");
          $this.removeClass("playlist-btn").addClass("playlist-btn-selected");
          // build the new playlist
          BCL.buildPlaylist($this.attr("data-index"));
        });
        // inject the first playlist and highlight the first tab
        $("#BCL_playlistSelector span").filter(":first").trigger("click");
      }
      /**** function to build the playlist ****/
      BCL.buildPlaylist = function (index) {
        var template = Handlebars.compile(BCL.playlistTemplate);
        var data = BCL.obj.playlistsData[index];
        var results = template(data);
        $("#BCL_playlist").html(results);        
        // add event listener for playlist items
        $(".playlist-item").on("click", function (evt) {
          var $this = $(this);
          // highlight selected item
          $this.siblings().removeClass("playlist-item-selected");
          $this.addClass("playlist-item-selected");
          var id = $this.attr
          // play the video
          BCL.videoPlayer.loadVideoByID($this.attr("data-id"));
        });
      }
      /*************************
      switch for flash/html
      *************************/
      // for development purposes only: reopen page with HTML5 player
      BCL.switchToHTML5 = function() {
          var separator = "?";
          if (document.location.href.indexOf("?", 0) > -1) {
           separator = "&";
          };
          window.location = document.location.href + separator + "forceHTML=true";
      };
      // for development purposes only: switch back to Flash
      BCL.switchToFlash = function () {
          var startOfQuery = document.location.href.indexOf("forceHTML", 0) -1;
          window.location = document.location.href.substring(0, startOfQuery);
      };
      /*************************
      logging
      *************************/
      BCL.log = function (message) {
        if (window["console"] && console["log"]) {
          var d = new Date();
          console.log(d + ": ");
          console.log(message);
        };
      };
    </script>
    
  </body>
</html>

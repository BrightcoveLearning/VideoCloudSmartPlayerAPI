<!DOCTYPE html>
<html>
	<head>
		<title>Player API Chaptering Example</title>
		<style>
		body {
			font-family: Helvetica,Arial,sans-serif;
		}
		.BrightcoveExperience {
			float: left;
			margin-right: 5px;
		}
		.BCL_playlist {
			border: 1px #999 solid;
			font-size: 10px;
			text-align: center;
			height: 270px;
			width: 100px;
			overflow: scroll;
		}
		.BCL_chapter {
			border-bottom: 1px #999 solid;
			padding: 3px;
		}
		.BCL_hide {
			display: none;
		}
		.BCL_highlight {
			background-color: #d8d8d8;
		}
		</style>
	</head>
	<body>
		<h1>Player API Chaptering Example</h1>
		<p>The player below plays a single video. The "playlist" is a set of chapters that are defined by cue points set in the video. The cue point name is the name of the chapter, and the cue point metadata contains the URL for a thumbnail image.
		<p><small><em>The buttons below are for development purposes only, to switch between Flash and  HTML5 players. Do not use these in production, as the method is unsupported. You should let the Smart Player decide whether to load Flash or HTML5 instead</em>.</small></p>
		<div id="modeSwitch">
			<button onclick="switchToHTML5()" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</button>
			<button onclick="switchToFlash()" style="margin-bottom: 20px;">Switch to Flash Player</button>
		</div>
		<!-- Start of Brightcove Player -->
		<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>

		<object id="myExperience" class="BrightcoveExperience">
			<param name="bgcolor" value="#FFFFFF" />
			<param name="width" value="480" />
			<param name="height" value="270" />
			<param name="playerID" value="1146049103001" />
			<param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WEd1K9zn5lA_OOffNUFbVae" />
			<param name="isVid" value="true" />
			<param name="isUI" value="true" />
			<param name="dynamicStreaming" value="true" />
			<param name="@videoPlayer" value="1595052160001" />
			<!-- params for Smart Player API -->
			<param name="includeAPI" value="true" />
			<param name="templateReadyHandler" value="onTemplateReady" />
		</object>

		<script type="text/javascript">brightcove.createExperiences();</script>

		<!-- End of Brightcove Player -->
		<div id="BCL_playlist" class="BCL_playlist"></div>
		<!-- include jquery -->
		<script type="text/javascript" src="http://files.brightcove.com/jquery-1.8.1.min.js"></script>
		<!-- include handlebars.js templating system -->
		<script type="text/javascript" src="http://files.brightcove.com/handlebars-1.0.rc.1.js"></script>
		<script type="text/javascript">
			(function(window) {
				// define the template for the chapters list
				var chaptersTemplate = "{{#cuePointData}}<div class=\"BCL_chapter\" onclick=\"playChapter({{time}})\"><img class=\"thumbnail\" height=\"40\" width=\"75\" src=\"{{metadata}}\"/><br />{{name}}</div>{{/cuePointData}}";
				var chapterTime,player,videoPlayer,cuePointsModule;
				// event listener for the player being ready
				onTemplateReady = function(event) {
					log("template ready");
					// get modules
					player = brightcove.api.getExperience("myExperience");
					videoPlayer = player.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER);
					videoPlayer.addEventListener(brightcove.api.events.MediaEvent.BEGIN,onMediaBegin);
					cuePointsModule = player.getModule(brightcove.api.modules.APIModules.CUE_POINTS);
					// capture the original video id to get the cue points
					videoPlayer.getCurrentVideo( function(videoDTO) {
							// call function to get cue points for the video
							getCuePoints(videoDTO.id);
						});
				 }
				// media begin listener
				function onMediaBegin(event) {
					log("media begin");
				}
				// function get cue points
				getCuePoints = function(videoID) {
					cuePointsModule.getCuePoints(videoID, function(cuePointData) {
						// make an object to pass to Handlebars
						var cuePointDataObj = {};
						// sort the array to get cue points in order
						cuePointData.sort( function(a,b) {
							return a.time - b.time;
						});
						// remove the preroll and postroll cue points
						cuePointData.splice(0,1);
						cuePointData.splice((cuePointData.length -1),1);
						// add the cue point data to the data object for Handlebars
						cuePointDataObj.cuePointData = cuePointData;
						// populate the template with data - standard Handlebars procedure here
						var template = Handlebars.compile(chaptersTemplate);
						var data = cuePointDataObj;
						var results = template(data);
						// inject the results into the page
						document.getElementById("BCL_playlist").innerHTML = results;
						// start the video
						videoPlayer.play();
					})
				}
				// play the chapter
				window.playChapter = function(time) {
					chapterTime = time;
					videoPlayer.getIsPlaying(function(isPlaying){
						if (isPlaying == true) {
							videoPlayer.seek(chapterTime);
						} else {
							videoPlayer.play();
							var t = window.setTimeout(seekToChapter,1000);
						}
					});
					
				}
				// seek utility function
				function seekToChapter(){
					videoPlayer.getIsPlaying(function(data) {
						if (data == true) {
							videoPlayer.seek(chapterTime);
						} else {
							videoPlayer.play();
							var t = window.setTimeout(seekToChapter,1000);
							// playChapter(time);
						}
					});
				}			// for development purposes only: reopen page with HTML5 player
				window.switchToHTML5 = function() {
					var separator = "?";
					if (document.location.href.indexOf("?", 0) > -1) {
						separator = "&";
					}
					window.location = document.location.href + separator + "forceHTML=true";
				};
				// for development purposes only: switch back to Flash
				window.switchToFlash = function() {
					var startOfQuery = document.location.href.indexOf("forceHTML", 0) - 1;
					window.location = document.location.href.substring(0, startOfQuery);
				};
				// debugging tool - wraps console.log to avoid errors in IE 7 & 8
				function log(message) {
				  if (window["console"] && console["log"]) {
				    var d = new Date();
				    console.log(d + ": ");
				    console.log(message);
				  }
				}
			})(window);
		</script>
	</body>
</html>
